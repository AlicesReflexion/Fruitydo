{% extends "base.html" %}
{% load staticfiles %}

{% block customscripts %}
<link rel="stylesheet" href="{% static 'jquery-ui-1.11.4.custom/jquery-ui.css' %}">
<script src="{% static 'jquery-ui-1.11.4.custom/external/jquery/jquery.js' %}"></script>
<script src="{% static 'jquery-ui-1.11.4.custom/jquery-ui.js' %}"></script>
<script>
	$(function() {
		$( ".datepicker" ).datepicker();
		$( ".datepicker" ).each(function() {
			$(this).datepicker('option', 'altField', "#desc" + this.id);
		})
	});
    </script>
    <script>
function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
var csrftoken = getCookie('csrftoken');
</script>

{% endblock %}

{% block title %}Profile{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<h1>Welcome back, {{ user.username }}</h1>
<script>


	$.post("{% url 'profilepage:event_fetch' %}", {date: "2016-05-03", task: "19", csrfmiddlewaretoken: csrftoken})
	.done(function(data) {
		alert(data);
	});

</script>
<form action="{% url 'profilepage:create' 'task_title' %}" method="post">
	{% csrf_token %}
	<input type="text" name="task_title">
	<input type="submit" value="+" class="newtaskbutton">
</form>
<h2>Incomplete tasks</h2>
<ul class="incompltetasks">
	{% for task in user.task_set.all %}
	{% if task.complete == 0 %}
	<li><form action="{% url 'profilepage:complete' task.id %}" method="post" class="completeform">
			{% csrf_token %}
			<input type="submit" value="âœ“" class="completebutton">
		</form>
		{{ task.task_title }}
		<table class="task_calendar">
			<tr>
				<td>
					<div class="datepicker" id="{{ task.id }}"></div>
				</td>
				<td>
					<textarea class="desc_input" id="desc{{ task.id }}"></textarea>
				</td>
		</tr>
		</table>
	</li>
	{% endif %}
	{% endfor %}
</ul>
<h2>Complete tasks</h2>
<ul class="completetasks">
	{% for task in user.task_set.all %}
	{% if task.complete == 1 %}
	<li>{{ task.task_title }}</li>
	<ul>
		{% for event in task.event_set.all %}
		<li>{{ event.event_description }}</li>
		{% endfor %}
	</ul>
	{% endif %}
	{% endfor %}
</ul>
{% endif %}
{% endblock %}

